generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
//
enum Role {
  USER
  MASTER
  ADMIN
}

//
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –∫–ª–∏–µ–Ω—Ç—ã –∏ –º–∞—Å—Ç–µ—Ä–∞
//
model User {
  id               Int                @id @default(autoincrement())
  email            String?            @unique
  name             String?
  passwordHash     String?
  role             Role               @default(USER)
  photoUrl         String?
  createdAt        DateTime           @default(now())

  // –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–∞
  appointments     Appointment[]      @relation("UserAppointments")

  // –ó–∞–ø–∏—Å–∏ –∫ –º–∞—Å—Ç–µ—Ä—É
  masterBookings   Appointment[]      @relation("MasterAppointments")

  // üí° –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  cartReservations CartReservation[]  @relation("UserCartReservations") // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ –∂–µ –∏–º—è!

  // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
  schedule         MasterSchedule[]

  // –í—ã—Ö–æ–¥–Ω—ã–µ / –æ—Ç–ø—É—Å–∫–∞ / –∏—Å–∫–ª—é—á–µ–Ω–∏—è
  daysOff          MasterDayOff[]
}

//
// –£—Å–ª—É–≥–∏
//
model Service {
  id                Int                @id @default(autoincrement())
  title             String
  shortDescription  String?
  fullDescription   String?
  price             Int
  durationMinutes   Int                // –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª—É–≥–∏
  photoUrl          String?

  appointments      Appointment[]
  cartReservations  CartReservation[] 
}

//
// –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ (–ü–Ω‚Äì–ü—Ç 10:00‚Äì18:00 –∏ —Ç.–ø.)
//
model MasterSchedule {
  id         Int      @id @default(autoincrement())
  master     User     @relation(fields: [masterId], references: [id])
  masterId   Int

  dayOfWeek  Int      // 0‚Äì6 (0 = Sunday)
  startTime  String   // "09:00"
  endTime    String   // "18:00"
}

//
// –í—ã—Ö–æ–¥–Ω—ã–µ / –æ—Ç–ø—É—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–∞
// (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã, –∫–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç)
//
model MasterDayOff {
  id         Int      @id @default(autoincrement())
  master     User     @relation(fields: [masterId], references: [id])
  masterId   Int

  date       DateTime // –ø—Ä–∏–º–µ—Ä: "2025-01-28"
}

//
// –ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ –∫ –º–∞—Å—Ç–µ—Ä—É –Ω–∞ —É—Å–ª—É–≥—É
//
model Appointment {
  id         Int      @id @default(autoincrement())

  // –ö–ª–∏–µ–Ω—Ç
  user       User     @relation("UserAppointments", fields: [userId], references: [id])
  userId     Int

  // –ú–∞—Å—Ç–µ—Ä
  master     User     @relation("MasterAppointments", fields: [masterId], references: [id])
  masterId   Int

  // –£—Å–ª—É–≥–∞
  service    Service  @relation(fields: [serviceId], references: [id])
  serviceId  Int

  // –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
  date       DateTime // —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞
  time       String   // –ø—Ä–∏–º–µ—Ä: "15:00"

  status     String   @default("pending")
  createdAt  DateTime @default(now())
}

//
// –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—Ç–æ–≤, –ø–æ–∫–∞ —É—Å–ª—É–≥–∞ –ª–µ–∂–∏—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ (30 –º–∏–Ω—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
//
model CartReservation {
  id               Int      @id @default(autoincrement())

  // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
  masterId         Int
  date             DateTime
  time             String   // –ü—Ä–∏–º–µ—Ä: "15:00"

  // üí° –ù–û–í–û–ï: –£—Å–ª—É–≥–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è durationMinutes)
  serviceId        Int
  service          Service  @relation(fields: [serviceId], references: [id])

  // –í—Ä–µ–º—è, –∫–æ–≥–¥–∞ —Ä–µ–∑–µ—Ä–≤ –∏—Å—Ç–µ–∫–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç)
  expiresAt        DateTime

  // –ö–ª–∏–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç —Ä–µ–∑–µ—Ä–≤ (–¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
  reservedByUserId Int

  // –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  user             User     @relation("UserCartReservations", fields: [reservedByUserId], references: [id])
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏:
  // –ú–∞—Å—Ç–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–∞ –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤—Ä–µ–º—è
  @@unique([masterId, date, time])
}