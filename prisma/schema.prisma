generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
//
enum Role {
  USER
  MASTER
  ADMIN
}

//
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –∫–ª–∏–µ–Ω—Ç—ã –∏ –º–∞—Å—Ç–µ—Ä–∞
//
model User {
  id               Int                @id @default(autoincrement())
  email            String?            @unique
  name             String?
  passwordHash     String?
  role             Role               @default(USER)
  photoUrl         String?
  createdAt        DateTime           @default(now())

  // –ó–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–∞
  appointments     Appointment[]      @relation("UserAppointments")

  // –ó–∞–ø–∏—Å–∏ –∫ –º–∞—Å—Ç–µ—Ä—É
  masterBookings   Appointment[]      @relation("MasterAppointments")

  // üí° –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
  cartReservations CartReservation[]  @relation("UserCartReservations") // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ –∂–µ –∏–º—è!

  // –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
  schedule         MasterSchedule[]

  // –í—ã—Ö–æ–¥–Ω—ã–µ / –æ—Ç–ø—É—Å–∫–∞ / –∏—Å–∫–ª—é—á–µ–Ω–∏—è
  daysOff          MasterDayOff[]
}

//
// –£—Å–ª—É–≥–∏
//
model Service {
  id                Int                @id @default(autoincrement())
  title             String
  shortDescription  String?
  fullDescription   String?
  price             Int
  durationMinutes   Int                // –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª—É–≥–∏
  photoUrl          String?

  appointments      Appointment[]
  cartReservations  CartReservation[] 
}

//
// –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ (–ü–Ω‚Äì–ü—Ç 10:00‚Äì18:00 –∏ —Ç.–ø.)
//
model MasterSchedule {
  id         Int      @id @default(autoincrement())
  master     User     @relation(fields: [masterId], references: [id])
  masterId   Int

  dayOfWeek  Int      // 0‚Äì6 (0 = Sunday)
  startTime  String   // "09:00"
  endTime    String   // "18:00"
}

//
// –í—ã—Ö–æ–¥–Ω—ã–µ / –æ—Ç–ø—É—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–∞
// (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã, –∫–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç)
//
model MasterDayOff {
  id         Int      @id @default(autoincrement())
  master     User     @relation(fields: [masterId], references: [id])
  masterId   Int

  date       DateTime // –ø—Ä–∏–º–µ—Ä: "2025-01-28"
}

//
// –ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞ –∫ –º–∞—Å—Ç–µ—Ä—É –Ω–∞ —É—Å–ª—É–≥—É
//
model Appointment {
  id        Int      @id @default(autoincrement())
  userId    Int
  masterId  Int
  serviceId Int
  date      DateTime
  time      String
  price     Float   
  status    String   @default("pending")
  createdAt DateTime @default(now())

  user      User     @relation("UserAppointments", fields: [userId], references: [id])
  master    User     @relation("MasterAppointments", fields: [masterId], references: [id])
  service   Service  @relation(fields: [serviceId], references: [id])
}


model CartReservation {
  id               Int      @id @default(autoincrement())

  masterId         Int
  date             DateTime
  time             String   

  serviceId        Int
  service          Service  @relation(fields: [serviceId], references: [id])

  expiresAt        DateTime

  reservedByUserId Int

  user             User     @relation("UserCartReservations", fields: [reservedByUserId], references: [id])
  

  @@unique([masterId, date, time])
}